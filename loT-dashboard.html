<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <style>
        /* ëª¨ë“  ìš”ì†Œì˜ ê¸°ë³¸ ì—¬ë°±ê³¼ íŒ¨ë”©ì„ 0ìœ¼ë¡œ ì„¤ì • */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ì „ì²´ í˜ì´ì§€ ë°°ê²½ê³¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        /* ì „ì²´ ë‚´ìš©ì„ ë‹´ëŠ” ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ìƒë‹¨ í—¤ë” ìŠ¤íƒ€ì¼ */
        header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        /* ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ: ì¢Œì„ í˜„í™©ë§Œ í‘œì‹œ */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* ì¹´ë“œ í˜•íƒœì˜ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        /* ì¢Œì„ 4ê°œë¥¼ 2x2ë¡œ ë°°ì¹˜ */
        .seats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* ê°œë³„ ì¢Œì„ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .seat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            transition: all 0.3s;
        }

        /* RFID ìƒíƒœ í‘œì‹œ ë°•ìŠ¤ */
        .rfid-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
        }

        .rfid-yes {
            background: #28a745;
        }

        .rfid-no {
            background: #dc3545;
        }

        /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì‚´ì§ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” íš¨ê³¼ */
        .seat:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .seat-number {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        /* LED í‘œì‹œë“± ìŠ¤íƒ€ì¼ (ì›í˜•) */
        .led-indicator {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        /* LEDê°€ ì²œì²œíˆ ì»¤ì¡Œë‹¤ ì‘ì•„ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ì´ˆë¡ìƒ‰ LED: ì •ìƒ ì´ìš© ì¤‘ */
        .led-green {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            box-shadow: 0 0 20px rgba(132, 250, 176, 0.6);
        }

        /* ë¹¨ê°„ìƒ‰ LED: ë¬´ë‹¨ ì‚¬ìš© */
        .led-red {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.6);
        }

        /* íŒŒë€ìƒ‰ LED: ì˜ˆì•½ë¨ */
        .led-blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.6);
        }

        /* ì£¼í™©ìƒ‰ LED: í™•ì¸ í•„ìš” */
        .led-orange {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 0 20px rgba(254, 225, 64, 0.6);
        }

        /* êº¼ì§„ LED: ë¹ˆ ì¢Œì„ */
        .led-off {
            background: #e0e0e0;
            box-shadow: none;
        }

        .seat-info {
            font-size: 13px;
            color: #666;
        }

        /* í•™ìƒ ì •ë³´ í‘œì‹œ */
        .seat-student {
            font-weight: bold;
            color: #333;
            margin: 5px 0;
        }

        /* í…Œì´ë¸”ì´ í™”ë©´ì„ ë„˜ì–´ê°€ë©´ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ */
        .table-container {
            overflow-x: auto;
        }

        /* í•™ìƒ ëª©ë¡ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        /* í…Œì´ë¸” í—¤ë” (ì œëª© í–‰) */
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        /* í…Œì´ë¸” ë°ì´í„° ì…€ */
        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }

        /* í…Œì´ë¸” í–‰ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ìƒ‰ ë³€ê²½ */
        tr:hover {
            background: #f8f9fa;
        }

        /* ê²½ê³  íšŸìˆ˜ í‘œì‹œ ë°°ì§€ */
        .warning-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ê²½ê³  0íšŒ: ì´ˆë¡ìƒ‰ */
        .warning-0 {
            background: #d4edda;
            color: #155724;
        }

        /* ê²½ê³  1íšŒ: ë…¸ë€ìƒ‰ */
        .warning-1 {
            background: #fff3cd;
            color: #856404;
        }

        /* ê²½ê³  2íšŒ: ì£¼í™©ìƒ‰ */
        .warning-2 {
            background: #f8d7da;
            color: #721c24;
        }

        /* ê²½ê³  3íšŒ: ë¹¨ê°„ìƒ‰ (ì´ìš©ì •ì§€) */
        .warning-3 {
            background: #721c24;
            color: white;
        }

        /* í•™ìƒ ìƒíƒœë³„ ìƒ‰ìƒ */
        .status-normal {
            color: #28a745;
            font-weight: bold;
        }

        .status-warning {
            color: #ffc107;
            font-weight: bold;
        }

        .status-danger {
            color: #dc3545;
            font-weight: bold;
        }

        .status-banned {
            color: #6c757d;
            font-weight: bold;
        }

        /* ì „ì²´ ë„ˆë¹„ë¥¼ ì°¨ì§€í•˜ëŠ” ìš”ì†Œ */
        .full-width {
            grid-column: 1 / -1;
        }

        /* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
        }

        /* ë²„íŠ¼ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ìƒ‰ ì§„í•˜ê²Œ + ìœ„ë¡œ ì‚´ì§ */
        .refresh-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        /* ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ */
        .timestamp {
            color: #999;
            font-size: 12px;
            text-align: right;
            margin-top: 10px;
        }

        /* ìƒíƒœ ë²”ë¡€ (ì–´ë–¤ ìƒ‰ì´ ë¬´ìŠ¨ ì˜ë¯¸ì¸ì§€ ì„¤ëª…) */
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        /* ë²”ë¡€ì˜ ì‘ì€ LED í‘œì‹œ */
        .legend-led {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ìƒë‹¨ ì œëª© ì˜ì—­ -->
        <header>
            <h1>ğŸ“š ìŠ¤ë§ˆíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p class="subtitle">AIoT + RFID ê¸°ë°˜ ì—´ëŒì‹¤ ë…¸ì‡¼ ë°©ì§€ ì‹œìŠ¤í…œ</p>
        </header>

        <div class="dashboard">
            <!-- ì‹¤ì‹œê°„ ì¢Œì„ í˜„í™© ì¹´ë“œ -->
            <div class="card">
                <h2>ğŸª‘ ì‹¤ì‹œê°„ ì¢Œì„ í˜„í™©</h2>
                
                <!-- LED ìƒ‰ìƒ ì˜ë¯¸ ì„¤ëª… -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-led led-off"></div>
                        <span>ë¹„ì–´ìˆìŒ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-led led-blue"></div>
                        <span>ì˜ˆì•½ë¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-led led-green"></div>
                        <span>ì •ìƒ ì´ìš©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-led led-orange"></div>
                        <span>í™•ì¸ í•„ìš”</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-led led-red"></div>
                        <span>ë¬´ë‹¨ ì‚¬ìš©</span>
                    </div>
                </div>

                <!-- ì¢Œì„ 4ê°œê°€ í‘œì‹œë  ì˜ì—­ -->
                <div class="seats-grid" id="seatsGrid"></div>
                
                <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
                <button class="refresh-btn" onclick="updateSeats()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                
                <!-- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ -->
                <div class="timestamp" id="timestamp"></div>
            </div>
        </div>

        <!-- í•™ìƒ ê²½ê³  í˜„í™© í…Œì´ë¸” -->
        <div class="card full-width">
            <h2>âš ï¸ í•™ìƒë³„ ê²½ê³  í˜„í™©</h2>
            <div class="table-container">
                <table id="studentTable">
                    <thead>
                        <tr>
                            <th>í•™ë²ˆ</th>
                            <th>ì´ë¦„</th>
                            <th>í˜„ì¬ ì¢Œì„</th>
                            <th>ê²½ê³  íšŸìˆ˜</th>
                            <th>ìƒíƒœ</th>
                            <th>ìµœê·¼ ìœ„ë°˜ ë‚´ì—­</th>
                            <th>ì´ìš©ì •ì§€ ì¢…ë£Œì¼</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ===== ë°ì´í„° ì €ì¥ ê³µê°„ =====
        // ì¢Œì„ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´ (ë¦¬ìŠ¤íŠ¸)
        // status ì¢…ë¥˜: 'empty'(ë¹„ì–´ìˆìŒ), 'reserved'(ì˜ˆì•½ë¨), 'normal'(ì •ìƒì´ìš©), 'check'(í™•ì¸í•„ìš”), 'unauthorized'(ë¬´ë‹¨ì‚¬ìš©)
        let seats = [
            { id: 1, status: 'empty', student: null, hasWeight: false, hasReservation: false, hasRFID: false },
            { id: 2, status: 'normal', student: '2023001', hasWeight: true, hasReservation: true, hasRFID: true },
            { id: 3, status: 'unauthorized', student: null, hasWeight: true, hasReservation: false, hasRFID: false },
            { id: 4, status: 'reserved', student: '2023003', hasWeight: false, hasReservation: true, hasRFID: false }
        ];

        // í•™ìƒ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´
        let students = [
            { id: '2023001', name: 'ê¹€ì² ìˆ˜', seat: 2, warnings: 0, status: 'normal', lastViolation: '-', banEndDate: '-' },
            { id: '2023002', name: 'ì´ì˜í¬', seat: null, warnings: 1, status: 'warning', lastViolation: '2ì‹œê°„ ë¹„ì›€', banEndDate: '-' },
            { id: '2023003', name: 'ë°•ë¯¼ìˆ˜', seat: 4, warnings: 2, status: 'danger', lastViolation: 'ë¬´ë‹¨ ì‚¬ìš©', banEndDate: '-' },
            { id: '2023004', name: 'ì •ìˆ˜ì§„', seat: null, warnings: 3, status: 'banned', lastViolation: '2ì‹œê°„ ë¹„ì›€', banEndDate: '2025-01-27' }
        ];

        // ===== ì¢Œì„ ìƒíƒœ ê²°ì • í•¨ìˆ˜ =====
        // ë¬´ê²Œ, ì˜ˆì•½, RFID ì •ë³´ë¥¼ ë°›ì•„ì„œ ì¢Œì„ ìƒíƒœë¥¼ íŒë‹¨í•˜ëŠ” í•¨ìˆ˜
        function determineSeatStatus(hasWeight, hasReservation, hasRFID) {
            // ì¡°ê±´ì— ë”°ë¼ ìƒíƒœë¥¼ ê²°ì •
            if (!hasWeight && !hasReservation && !hasRFID) {
                return 'empty';  // ë¹„ì–´ìˆìŒ
            } else if (!hasWeight && hasReservation && !hasRFID) {
                return 'reserved';  // ì˜ˆì•½ë¨
            } else if (hasWeight && hasReservation && hasRFID) {
                return 'normal';  // ì •ìƒ ì´ìš©
            } else if (hasWeight && hasReservation && !hasRFID) {
                return 'check';  // í™•ì¸ í•„ìš”
            } else if (hasWeight && !hasReservation && !hasRFID) {
                return 'unauthorized';  // ë¬´ë‹¨ ì‚¬ìš©
            }
            return 'empty';  // ê¸°ë³¸ê°’
        }

        // ===== ì¢Œì„ í™”ë©´ì— ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
        function renderSeats() {
            // HTMLì—ì„œ ì¢Œì„ ì˜ì—­ì„ ì°¾ì•„ì˜´
            const grid = document.getElementById('seatsGrid');
            grid.innerHTML = '';  // ê¸°ì¡´ ë‚´ìš©ì„ ì§€ì›€

            // ì¢Œì„ ë°°ì—´ì„ í•˜ë‚˜ì”© ì²˜ë¦¬
            seats.forEach(seat => {
                // ê¸°ë³¸ê°’ ì„¤ì •
                let ledClass = 'led-off';
                let statusText = 'ë¹„ì–´ìˆìŒ';
                let emoji = 'âšª';
                let studentInfo = '';

                // ì¢Œì„ ìƒíƒœì— ë”°ë¼ LED ìƒ‰ìƒê³¼ í…ìŠ¤íŠ¸ ë³€ê²½
                if (seat.status === 'empty') {
                    ledClass = 'led-off';
                    statusText = 'ë¹„ì–´ìˆìŒ';
                    emoji = 'âšª';
                } else if (seat.status === 'reserved') {
                    ledClass = 'led-blue';
                    statusText = 'ì˜ˆì•½ë¨';
                    emoji = 'ğŸ”µ';
                    // ì˜ˆì•½í•œ í•™ìƒ ì •ë³´ ì°¾ê¸°
                    const student = students.find(s => s.id === seat.student);
                    if (student) {
                        studentInfo = `<div class="seat-student">${student.name} (${student.id})</div>`;
                    }
                } else if (seat.status === 'normal') {
                    ledClass = 'led-green';
                    statusText = 'ì •ìƒ ì´ìš©';
                    emoji = 'ğŸŸ¢';
                    const student = students.find(s => s.id === seat.student);
                    if (student) {
                        studentInfo = `<div class="seat-student">${student.name} (${student.id})</div>`;
                    }
                } else if (seat.status === 'check') {
                    ledClass = 'led-orange';
                    statusText = 'í™•ì¸ í•„ìš”';
                    emoji = 'ğŸŸ ';
                    const student = students.find(s => s.id === seat.student);
                    if (student) {
                        studentInfo = `<div class="seat-student">${student.name} (${student.id})</div>`;
                    }
                } else if (seat.status === 'unauthorized') {
                    ledClass = 'led-red';
                    statusText = 'ë¬´ë‹¨ ì‚¬ìš©';
                    emoji = 'ğŸ”´';
                    studentInfo = '<div class="seat-student">ë¯¸ë“±ë¡ ì‚¬ìš©ì</div>';
                }

                // HTML ì½”ë“œë¥¼ ë§Œë“¤ì–´ì„œ í™”ë©´ì— ì¶”ê°€
                // RFID ìƒíƒœ í‘œì‹œ ì¶”ê°€
                const rfidClass = seat.hasRFID ? 'rfid-yes' : 'rfid-no';
                const rfidText = seat.hasRFID ? 'RFID â—‹' : 'RFID âœ•';
                
                grid.innerHTML += `
                    <div class="seat">
                        <div class="rfid-status ${rfidClass}">${rfidText}</div>
                        <div class="seat-number">ì¢Œì„ ${seat.id}</div>
                        <div class="led-indicator ${ledClass}">${emoji}</div>
                        ${studentInfo}
                        <div class="seat-info">${statusText}</div>
                    </div>
                `;
            });

            // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
            updateTimestamp();
        }

        // ===== í•™ìƒ í…Œì´ë¸” ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
        function renderStudentTable() {
            // HTMLì—ì„œ í…Œì´ë¸” ë³¸ë¬¸ ì°¾ê¸°
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';  // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°

            // í•™ìƒ ë°°ì—´ì„ í•˜ë‚˜ì”© ì²˜ë¦¬
            students.forEach(student => {
                // ê²½ê³  íšŸìˆ˜ì— ë”°ë¼ ë°°ì§€ ìƒ‰ìƒ ê²°ì •
                const warningClass = `warning-${student.warnings}`;
                let statusClass = '';
                let statusText = '';

                // í•™ìƒ ìƒíƒœì— ë”°ë¼ ìƒ‰ìƒê³¼ í…ìŠ¤íŠ¸ ì„¤ì •
                switch(student.status) {
                    case 'normal':
                        statusClass = 'status-normal';
                        statusText = 'ì •ìƒ';
                        break;
                    case 'warning':
                        statusClass = 'status-warning';
                        statusText = 'ì£¼ì˜';
                        break;
                    case 'danger':
                        statusClass = 'status-danger';
                        statusText = 'ìœ„í—˜';
                        break;
                    case 'banned':
                        statusClass = 'status-banned';
                        statusText = 'ì´ìš©ì •ì§€';
                        break;
                }

                // ì¢Œì„ ë²ˆí˜¸ í‘œì‹œ (ì—†ìœ¼ë©´ '-')
                const seatDisplay = student.seat ? `ì¢Œì„ ${student.seat}` : '-';

                // í…Œì´ë¸” í–‰ ì¶”ê°€
                tbody.innerHTML += `
                    <tr>
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${seatDisplay}</td>
                        <td><span class="${warningClass} warning-badge">${student.warnings}íšŒ</span></td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>${student.lastViolation}</td>
                        <td>${student.banEndDate}</td>
                    </tr>
                `;
            });
        }

        // ===== í˜„ì¬ ì‹œê°„ í‘œì‹œ í•¨ìˆ˜ =====
        function updateTimestamp() {
            const now = new Date();  // í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
            const timeString = now.toLocaleString('ko-KR');  // í•œêµ­ì–´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            document.getElementById('timestamp').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${timeString}`;
        }

        // ===== ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ =====
        function updateSeats() {
            // ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì—¬ê¸°ì„œ ì•„ë‘ì´ë…¸ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë°›ì•„ì˜´
            // ì˜ˆ: fetch('oneM2Mì„œë²„ì£¼ì†Œ/api/seats').then(...)
            
            console.log('ì¢Œì„ ì •ë³´ ì—…ë°ì´íŠ¸ ì¤‘...');
            
            // í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            renderSeats();
            renderStudentTable();
        }

        // ===== í”„ë¡œê·¸ë¨ ì‹œì‘ =====
        // í˜ì´ì§€ê°€ ë¡œë“œë˜ë©´ ì²˜ìŒ í•œ ë²ˆ í™”ë©´ ê·¸ë¦¬ê¸°
        renderSeats();
        renderStudentTable();

        // 5ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
        setInterval(updateSeats, 5000);
    </script>
</body>
</html>
